<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Registro por Voz - Individual</title>
</head>
<body>
  <h1>Registro por Voz</h1>

  <button onclick="startRecognition('linha')">ğŸ¤ Falar Linha</button>
  <button onclick="startRecognition('codigo')">ğŸ¤ Falar CÃ³digo da PeÃ§a</button>
  <button onclick="startRecognition('tipo')">ğŸ¤ Falar Tipo da PeÃ§a</button>
  <button onclick="startRecognition('local')">ğŸ¤ Falar Local de InstalaÃ§Ã£o</button>
  <button onclick="startRecognition('obs')">ğŸ¤ Falar ObservaÃ§Ã£o</button>
  <br><br>
  <button onclick="sendData()">ğŸ“¤ Enviar para Planilha</button>

  <div id="status"></div>

  <ul>
    <li><strong>Linha:</strong> <span id="linha"></span></li>
    <li><strong>CÃ³digo da PeÃ§a:</strong> <span id="codigo"></span></li>
    <li><strong>Tipo da PeÃ§a:</strong> <span id="tipo"></span></li>
    <li><strong>Local de InstalaÃ§Ã£o:</strong> <span id="local"></span></li>
    <li><strong>ObservaÃ§Ã£o:</strong> <span id="obs"></span></li>
  </ul>

  <script>
    let dados = {
      linha: '',
      codigo: '',
      tipo: '',
      local: '',
      obs: ''
    };

    function startRecognition(campo) {
      if (!('webkitSpeechRecognition' in window)) {
        alert('Use o Google Chrome no Android ou PC.');
        return;
      }

      const recognition = new webkitSpeechRecognition();
      recognition.lang = 'pt-BR';
      recognition.continuous = false;
      recognition.interimResults = false;

      document.getElementById('status').innerText = `ğŸ™ï¸ Fale o campo: ${campo}`;

      recognition.onresult = function (event) {
        const texto = event.results[0][0].transcript.trim();
        dados[campo] = texto;
        document.getElementById(campo).innerText = texto;
        document.getElementById('status').innerText = `âœ… ${campo} registrado: ${texto}`;
      };

      recognition.onerror = function (event) {
        document.getElementById('status').innerText = 'âŒ Erro: ' + event.error;
      };

      recognition.start();
    }

    function sendData() {
      const { linha, codigo, tipo, local, obs } = dados;
      if (!linha || !codigo || !tipo || !local) {
        alert('Preencha todos os campos obrigatÃ³rios (linha, cÃ³digo, tipo, local).');
        return;
      }

      const agora = new Date();
      const payload = {
        linha,
        codigo,
        tipo,
        local,
        obs,
        data: agora.toLocaleDateString('pt-BR'),
        hora: agora.toLocaleTimeString('pt-BR')
      };

      fetch('https://script.google.com/macros/s/AKfycbypDmhOMO9YWp1Z1cD5crM7XkSELLpXHDXnYjfIbX0G15KdoByN8vf4WhljDwZIGIwPcQ/exec', {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(res => res.text())
        .then(txt => {
          document.getElementById('status').innerText = 'âœ… Dados enviados com sucesso!';
          Object.keys(dados).forEach(k => {
            dados[k] = '';
            document.getElementById(k).innerText = '';
          });
        })
        .catch(err => {
          document.getElementById('status').innerText = 'âŒ Erro ao enviar: ' + err;
        });
    }
  </script>
</body>
</html>
